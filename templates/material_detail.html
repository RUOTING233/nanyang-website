<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>{{ material.folder_name }} - å²æ–™è¯¦æƒ…</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/creation.css') }}">
    <style>
        /* é’ˆå¯¹æœ¬é¡µé¢çš„å¾®è°ƒ */
        body { background-color: #fdfbf5; }

        /* æ ‡é¢˜åŒº */
        .detail-header { 
            text-align: center; 
            margin-top: 60px; 
            margin-bottom: 30px; 
            padding-bottom: 20px; 
            border-bottom: 2px dashed #CD5C5C; 
        }

        .detail-header h2 { 
            font-family: 'MyWebFont', serif; 
            color: #CD5C5C; 
            margin: 0; 
            /* è‡ªåŠ¨ç¼©æ”¾å­—ä½“ */
            font-size: clamp(16px, 3vw, 32px);
            white-space: normal;
            word-wrap: break-word;
            max-width: 95%; 
            margin: 0 auto; 
            line-height: 1.4;
        }

        /* äººç‰©å°æ ‡é¢˜æ ·å¼ */
        .author-subtitle {
            font-size: 1.2rem;
            color: #555;
            margin-top: 10px;
            font-family: 'MyWebFont', serif;
        }

        /* ã€ä¿®æ”¹ã€‘å­æ–‡ä»¶å¤¹åŒºåŸŸæ ·å¼ 
           ç°åœ¨ä½¿ç”¨ grid å¸ƒå±€ï¼Œä¸éœ€è¦åŸæ¥çš„ list æ ·å¼äº†
        */
        .sub-folders-container {
            margin-bottom: 50px;
            padding-bottom: 20px;
            /* å¦‚æœæœ‰å­æ–‡ä»¶å¤¹ï¼Œç»™åº•éƒ¨åŠ ä¸ªåˆ†å‰²çº¿åŒºåˆ†æ–‡ä»¶åŒº */
            border-bottom: 1px dashed #ddd; 
        }
        
        /* è¿™é‡Œçš„ .material-grid å’Œ .folder-card ä¼šè‡ªåŠ¨ç»§æ‰¿ creation.css é‡Œçš„æ ·å¼ */

        /* å›¾ç‰‡å®¹å™¨ */
        .zoom-wrapper {
            transition: transform 0.2s ease-out;
            transform-origin: top center;
        }

        /* å›¾ç‰‡ç”»å»Š */
        .image-gallery { text-align: center; padding-bottom: 20px; }
        .gallery-item { margin-bottom: 40px; display: block; }
        .gallery-item img {
            max-width: 90%; 
            height: auto; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid #ddd;
        }

        /* PDF å’Œ TXT åˆ—è¡¨ */
        .file-list { list-style: none; padding: 0; text-align: left; max-width: 800px; margin: 0 auto; }
        .file-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; align-items: center; }
        .file-icon { margin-right: 10px; font-weight: bold; font-size: 1.2em; }
        .file-link { text-decoration: none; color: #333; flex: 1; }
        .file-link:hover { color: #CD5C5C; }
    </style>
</head>
<body>

    <a href="javascript:history.back()" class="fixed-back-btn">â† è¿”å›</a>

    <div class="library-container" style="max-width: 1200px;">
        
        <div class="detail-header">
            <h2>{{ material.folder_name }} {% if subpath %}/ {{ subpath.split('/')[-1] }}{% endif %}</h2>
            
            {% set author_map = {
                'yingzi': 'è¹å§¿',
                'fengyimei': 'å†¯ä¼Šæ¹„',
                'wangyingxia': 'ç‹æ˜ éœ',
                'wangying': 'ç‹è¹',
                'shenzijiu': 'æ²ˆå…¹ä¹'
            } %}
            <div class="author-subtitle">â€”â€” {{ author_map[material.author] }} â€”â€”</div>
        </div>

        {% if dirs %}
        <div class="sub-folders-container">
            <h3 style="text-align: center; color: #888; font-size: 16px; margin-bottom: 20px;">- å­æ–‡ä»¶å¤¹ -</h3>
            
            <div class="material-grid">
                {% for d in dirs %}
                    {% set new_path = d if not subpath else subpath + '/' + d %}
                    <a href="{{ url_for('material_detail', id=material.id, subpath=new_path) }}" class="folder-card">
                        <div class="folder-name">{{ d }}</div>
                    </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div id="zoom-container" class="zoom-wrapper">
            
            <div class="image-gallery">
                {% for f in files if f.lower().endswith(('.jpg', '.jpeg', '.png')) %}
                <div class="gallery-item">
                    <img src="{{ url_for('static', filename='materials/' + material.author + '/' + material.folder_name + '/' + (subpath + '/' + f if subpath else f)) }}" alt="{{ f }}">
                </div>
                {% endfor %}
            </div>

            <ul class="file-list">
                {% for f in files if f.lower().endswith(('.pdf', '.txt')) %}
                <li class="file-item">
                    <span class="file-icon">
                        {% if f.endswith('.pdf') %}ğŸ“„{% else %}ğŸ“{% endif %}
                    </span>
                    <a href="{{ url_for('static', filename='materials/' + material.author + '/' + material.folder_name + '/' + (subpath + '/' + f if subpath else f)) }}" target="_blank" class="file-link">
                        {{ f }}
                    </a>
                </li>
                {% endfor %}
            </ul>

            {% if not dirs and not files %}
                <p style="text-align:center; color:#999; margin-top:50px;">(è¯¥æ–‡ä»¶å¤¹ä¸ºç©º)</p>
            {% endif %}

        </div>

        {% if material.source and material.source != 'æš‚æ— ' %}
        <div class="source-box">
            <p><strong>æ–‡çŒ®æ¥æºï¼š</strong> {{ material.source | safe }}</p>
        </div>
        {% endif %}

    </div>

    <div class="zoom-controls">
        <button onclick="zoomIn()" class="zoom-btn" title="æ”¾å¤§">+</button>
        <button onclick="zoomOut()" class="zoom-btn" title="ç¼©å°">-</button>
        <button onclick="zoomReset()" class="zoom-btn reset-btn" title="é‡ç½®">1:1</button>
    </div>

    <script>
        var currentZoom = 1.0;
        var container = document.getElementById('zoom-container');

        function zoomIn() {
            currentZoom += 0.1;
            updateZoom();
        }

        function zoomOut() {
            if (currentZoom > 0.2) {
                currentZoom -= 0.1;
                updateZoom();
            }
        }

        function zoomReset() {
            currentZoom = 1.0;
            updateZoom();
        }

        function updateZoom() {
            container.style.transform = "scale(" + currentZoom + ")";
        }
    </script>

</body>
</html>